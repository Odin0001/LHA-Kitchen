import{u as B,r as s,f as G,Q as d,j as t,g as w,d as v,a as L,G as Q,b as z}from"./index-56e58669.js";import{g as A,v as F,r as H,u as M,a as X}from"./v4-803aab98.js";import{g as Y}from"./index-e3d5d3f4-e6ed04b4.js";import{S as _}from"./Spinner-82b55c3e.js";const W=()=>{const p=Y(),i=B(),[n,g]=s.useState([]),[f,N]=s.useState(""),[x,R]=s.useState({}),[I,o]=s.useState(!1),[b,q]=s.useState(null),h=G();s.useEffect(()=>{o(!0);async function e(){const l=w(v,"recipes",h.recipeId),c=await L(l);c.exists()?(q(c.data()),g([c.data()]),o(!1)):(i("/"),d.error("Recipe does not exist"))}e()},[i,h.recipeId]),s.useEffect(()=>{b&&b.userRef!==p.currentUser.uid&&(d.error("You can not edit this recipe"),i("/"))},[p.currentUser.uid,b,i]);const[r,m]=s.useState({title:"",name:"",quantity:""});function S(e){e.preventDefault(),r.title!==""&&r.name!==""&&r.quantity!==""&&(g([...n,r]),m({name:"",quantity:""}))}const U=e=>{n.splice(e,1),g([...n])};async function C(){if(console.log([...n,f,x]),o(!0),x.length>1){o(!1),d.error("Maximum images allowed are 1");return}async function e(u){return new Promise((E,k)=>{const D=A(),P=`${p.currentUser.uid}-${u.name}-${F()}`,$=H(D,P),j=M($,u);j.on("state_changed",a=>{const T=a.bytesTransferred/a.totalBytes*100;switch(console.log("Upload is "+T+"% done"),a.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},a=>{k(a)},()=>{X(j.snapshot.ref).then(a=>{E(a)})})})}const l=await Promise.all([...x].map(u=>e(u))).catch(u=>{o(!1),d.error("Images not uploaded")}),c={items:n,desc:f,imgUrls:l,timestamp:Q(),userRef:p.currentUser.uid},y=w(v,"recipes",h.recipeId);await z(y,c),o(!1),d.success("Recipe was updated"),i(`/recipes/${y.id}`)}return I?t.jsx(_,{}):t.jsxs("main",{className:"max-w-xl mx-auto my-8 px-2",children:[t.jsx("h1",{className:"text-4xl text-center mt-6 font-bold text-green-600 mt-6",children:"Edit Recipe"}),t.jsxs("div",{className:"rounded-lg bg-green-500 p-4 mt-6",children:[t.jsxs("form",{className:"grid grid-cols-6 items-center text-gray-700",children:[t.jsx("input",{className:"col-span-6 mb-4 p-3 border border-gray-300 focus:border-2 focus:border-green-600 outline-none rounded",type:"text",placeholder:"Recipe Title",required:!0,value:r.title,onChange:e=>m({...r,title:e.target.value})}),t.jsx("input",{className:"col-span-3 p-3 border border-gray-300 focus:border-2 focus:border-green-600 outline-none rounded placeholder:lg:text-lg placeholder:text-sm",type:"text",placeholder:"Item with Unit",required:!0,value:r.name,onChange:e=>m({...r,name:e.target.value})}),t.jsx("input",{className:"col-span-2 p-3 border border-gray-300 focus:border-2 focus:border-green-600 outline-none rounded mx-3 placeholder:lg:text-lg placeholder:text-sm",type:"number",placeholder:"Quantity",required:!0,min:"0",value:r.quantity,onChange:e=>m({...r,quantity:e.target.value})}),t.jsx("button",{className:"text-white text-xl bg-green-700 hover:bg-green-600 p-3 text-xl rounded transition duration-500 ease",type:"button",onClick:S,children:"+"}),t.jsxs("div",{className:"my-3 col-span-6",children:[t.jsx("p",{className:"mb-2 text-xl font-semibold",children:"Image"}),t.jsx("input",{type:"file",id:"images",accept:".jpg, .png, .jpeg",required:!0,onChange:e=>R(e.target.files),className:"w-full bg-white px-3 py-1.5 border border-gray-300 rounded"})]})]}),t.jsxs("ul",{children:[n.map((e,l)=>t.jsxs("li",{className:"my-4 w-full flex justify-between bg-green-300 rounded",children:[t.jsxs("div",{className:"p-4 w-full flex justify-between",children:[t.jsx("span",{children:e.name}),t.jsx("span",{children:e.quantity})]}),t.jsx("button",{onClick:()=>U(l),className:"ml-8 p-4 border-l-2 border-green-700 hover:bg-green-400 w-16 transition duration-500 ease",children:"X"})]},l)),t.jsx("textarea",{cols:"30",rows:"10",placeholder:"How to Prepare",required:!0,value:f,onChange:e=>N(e.target.value),className:"w-full mt-6 rounded border border-gray-300 focus:border-2 focus:border-green-600 outline-none resize-none p-4"}),t.jsx("button",{type:"button",onClick:C,className:"w-full py-2 mt-4 rounded text-white text-center bg-green-700 hover:bg-green-600 text-xl transition duration-500 ease",children:"Edit Recipe"})]})]})]})};export{W as default};
